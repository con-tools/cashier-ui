<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-styles/typography.html">

<dom-module id="controll-event-search">
<template>
	<style>
	*[lang=he] {
		direction: rtl;
	}
	paper-material {
		background: white;
		padding: 1em;
		margin-bottom: 1em;
	}
	</style>
	
	<paper-material lang="he">
		<h1 class="page-title" tabindex="-1">חיפוש ארועים</h1>
		<paper-item>
			<paper-input name="name" label="שם" on-keyup="doSearch" id="searchName">
		</paper-item>
		
	</paper-material>
	
	<paper-material lang="he">
		<template is="dom-repeat" items="[[filteredTimeslots]]" as="timeslot">
			<paper-item>
				<paper-icon-button icon="exit-to-app" ontap="showEvent"></paper-icon-button>
				<paper-icon-button icon="shopping-cart" ontap="addToCart"></paper-icon-button>
				<div>[[timeslot.event.title]]</div>
			</paper-item>
		</template>
	</paper-material>
</template>
</dom-module>

<script>
Polymer({
	is : 'controll-event-search',
	properties : {
		timeslots : {
			type: Array,
			value: function() { return []; }
		},
		filteredTimeslots : {
			type: Array,
			value: function() { return []; }
		}
	},
	
	ready : function(event) {
		this.set('timeslots',[]);
		app.getCatalog('timeslots',this.populateTimeslots.bind(this));
	},
	
	attached : function(event) {
		app.addEventListener('please-refresh-lists', this.ready.bind(this), false);
	},
	
	populateTimeslots : function(timeslots) {
		this.set('timeslots',timeslots);
	},
	
	doSearch : function() {
		title = this.$.searchName.value;
		var re = new RegExp(title);
		this.filteredTimeslots = this.timeslots.filter(function(ts){
			return ts.event.title.match(re);
		});
	},
	
	addToCart : function(ev) {
		app.addToCart(ev.model.timeslot);
	}
});
</script>
